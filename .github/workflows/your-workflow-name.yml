name: Portfolio Website CI/CD
on: 
  workflow_dispatch:  # Allows manual triggering
  push:
    branches: [ main ]  # Triggers on push to main branch
  pull_request:
    branches: [ main ]  # Triggers on PRs to main

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js (if needed)
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: ğŸ” List project files
        run: |
          echo "ğŸ“ Project structure:"
          find . -type f -name "*.html" -o -name "*.css" -o -name "*.js" -o -name "*.json" | head -20
          
      - name: âœ… Validate HTML files
        run: |
          echo "ğŸ” Checking for HTML files..."
          if find . -name "*.html" -type f | grep -q .; then
            echo "âœ… HTML files found - validating structure..."
            for file in $(find . -name "*.html" -type f); do
              echo "Checking $file..."
              if grep -q "<!DOCTYPE" "$file"; then
                echo "âœ… $file has DOCTYPE declaration"
              else
                echo "âš ï¸ $file missing DOCTYPE declaration"
              fi
            done
          else
            echo "â„¹ï¸ No HTML files found to validate"
          fi
          
      - name: ğŸ¨ Validate CSS files
        run: |
          echo "ğŸ” Checking for CSS files..."
          if find . -name "*.css" -type f | grep -q .; then
            echo "âœ… CSS files found - basic validation..."
            for file in $(find . -name "*.css" -type f); do
              echo "Checking $file..."
              if [ -s "$file" ]; then
                echo "âœ… $file is not empty"
              else
                echo "âš ï¸ $file is empty"
              fi
            done
          else
            echo "â„¹ï¸ No CSS files found to validate"
          fi
          
      - name: ğŸŒ Send deployment webhook
        run: |
          echo "ğŸš€ Sending deployment notification..."
          curl -X POST "https://webhook.site/1234-5678-99abc" \
               -H "Content-Type: application/json" \
               -H "X-GitHub-Event: deployment" \
               -d '{
                 "event": "portfolio_deployment",
                 "repository": "muhammadehmed123/portfolio-website",
                 "branch": "${{ github.ref_name }}",
                 "commit": "${{ github.sha }}",
                 "timestamp": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'",
                 "status": "success"
               }'
          echo "âœ… Webhook sent successfully!"
          
      - name: ğŸ“Š Build Summary
        run: |
          echo "ğŸ‰ Portfolio Website CI/CD Pipeline Complete!"
          echo "ğŸ“… Build Date: $(date)"
          echo "ğŸ”— Repository: muhammadehmed123/portfolio-website"
          echo "ğŸŒ¿ Branch: ${{ github.ref_name }}"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "âœ… All checks passed - ready for deployment!"
